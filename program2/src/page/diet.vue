<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="static/css/main.css">
    <style>
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #diet-plan {
            margin-top: 20px;
            font-size: 18px;
        }
        #diet_write_btn{
            float: right;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 6px solid white;
            background-image: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            color: white;
            font-weight: bold;
            font-size: 17px;
            width: 170px;
            height: 50px;
            border-radius: 10px;
            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.34) inset, 0 2px 0 -1px rgba(0, 0, 0, 0.13), 0 3px 0 -1px rgba(0, 0, 0, 0.08), 0 3px 13px -1px rgba(0, 0, 0, 0.21);
        }
        .body-wrapper{
            float: left;
            padding: 20px;
            padding-bottom: 0px;
            width: 50%;
            box-sizing: border-box;
        }
        .body-img-wrapper {
            display: inline-block;
            width: 47%;
            position: relative;
            top: 25px;
        }

        .body-info-wrapper {
            display: inline-block;
            background-color: #f7f9fc;
            border-radius: 8px;
            padding: 20px;
            max-width: 210px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .title {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 18px;
            font-weight: bold;
            color: #444;
            margin: 15px 0 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .info-item span {
            font-size: 16px;
            color: #555;
        }

        .value {
            font-weight: bold;
            color: #333;
        }

        .inbody-info {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .inbody-info .info-item {
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        .inbody-info .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .circle{
            font-weight: bold; color: white; width : 140px; height : 140px; border-radius: 50%; border: none;
            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.34) inset, 0 2px 0 -1px rgba(0, 0, 0, 0.13), 0 3px 0 -1px rgba(0, 0, 0, 0.08), 0 3px 13px -1px rgba(0, 0, 0, 0.21);
        }
        #day-btn{
            background-image: linear-gradient(to top, #fad0c4 0%, #ffd1ff 100%);
        }
        #week-btn{
            background-image: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
        }
        #btn-wrapper{
            width: 90%;
            display: flex;
            justify-content: space-around;
        }
        #plan-wrapper{
            padding-top: 0px;
            height: 410px;
        }
        .scrollbar { 
        height: 100%;
        overflow-y: scroll; /*  */
        }

        /* 스크롤바의 폭 너비 */
        .scrollbar::-webkit-scrollbar {
            width: 10px;  
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: rgb(176, 193, 255); /* 스크롤바 색상 */
            border-radius: 10px; /* 스크롤바 둥근 테두리 */
        }

        .scrollbar::-webkit-scrollbar-track {
            background: rgba(168, 212, 255, 0.1);  /*스크롤바 뒷 배경 색상*/
        }
        .day-box {
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .day-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .day-box h3 {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            background-image: linear-gradient(90deg, #fbc2eb 0%, #a6c1ee 100%);
            color: white;
            padding: 5px;
            border-radius: 5px;
        }

        .day-box p {
            font-size: 16px;
            margin-bottom: 8px;
            padding: 5px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .day-box p strong {
            color: #444;
        }

        #diet-plan {
            padding: 20px;
        }

        #loading {
            font-size: 20px;
            color: #666;
            text-align: center;
            padding: 20px;
        }

        #diet-plan .day-box .diet-meal {
            background-color: #eef1f5;
            border-radius: 5px;
            margin: 8px 0;
            padding: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        .diet-explanation {
            font-size: 14px;
            margin-top: 15px;
            background-color: #fcf1f1;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body>
    <div id="header">
        <h1 id="logo">KcalFit</h1>
        <ul id="menu">
            <a href="/"><li>홈</li></a>
            <a href="/diet"><li class="onlink">식단</li></a>
            <a href="/moisture"><li>수분</li></a>
            <a href="/exercise"><li>운동</li></a>
            <a href="/alarm"><li>알림</li></a>
            <a href="/mypage"><li>마이페이지</li></a>
        </ul>
    </div>
    <div id="container">
        <a href="/diet_write" id="diet_write_btn">나의 식단 작성</a><br><br>
        <div class="body-wrapper">
            <div style="margin-bottom: 10px;">
            <h2 style="padding:10px; text-align:center;">현재 측정 상태</h2><hr>
                <div class="body-img-wrapper">
                    <div>
                        <img src="static/img/body.png" alt="몸" style="vertical-align: sub;">
                    </div>
                </div>
                <div class="body-info-wrapper">
                    <div class="info-item">
                        <span>키:</span>
                        <span class="value">{{ body_info['height'] }} cm</span>
                    </div>
                    <div class="info-item">
                        <span>몸무게:</span>
                        <span class="value">{{ body_info['weight'] }} Kg</span>
                    </div>
                    <p class="subtitle">인바디 정보</p>
                    <div class="inbody-info">
                        <div class="info-item">
                            <span>체지방률 (%):</span>
                            <span class="value">{{ body_info['body_fat_percentage'] }}</span>
                        </div>
                        <div class="info-item">
                            <span>골격근량 (kg):</span>
                            <span class="value">{{ body_info['skeletal_muscle_mass'] }}</span>
                        </div>
                        <div class="info-item">
                            <span>기초대사량 (kcal):</span>
                            <span class="value">{{ body_info['basal_metabolic_rate'] }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="btn-wrapper">
                <button id="day-btn" class="circle">하루 식단<br>생성</button>
                <button id="week-btn" class="circle">일주일 식단 생성</button>
            </div>
        </div>
        <div class="body-wrapper" id="plan-wrapper">
            <h2 style="padding:10px; text-align:center;">식단</h2><hr>
            <div id="loading" style="display: none;">식단 생성하는 중...</div>
            <div id="diet-plan" class="scrollbar"></div>
        </div>

    
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            document.getElementById('day-btn').addEventListener('click', function() {
                getDietPlan('하루');
            });

            document.getElementById('week-btn').addEventListener('click', function() {
                getDietPlan('일주일');
            });

            function getDietPlan(diet_type) {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('diet-plan').innerHTML = '';
                
                // if(diet_type == "day"){
                //     const rp = `
                //     아침: 쌀밥 1공기, 김치찌개, 계란후라이, 고구마 
                //     점심: 된장찌개, 계란말이, 김밥, 부추전, 겉절이 
                //     저녁: 소고기 불고기, 된장찌개, 샐러드, 김치 
                //     간식: 과일, 미니 샌드위치, 두유 
                //     식사 후에는 충분한 수분을 섭취하고, 운동을 통해 건강한 체중 유지와 체지방 감소를 도와주실 것을 권장합니다.
                //     `;
                //     const mealMatches = rp.match(/(아침|점심|저녁|간식):\s?([^\n]+)/g);
                //     const explanation = rp.split(/간식:\s?[^\n]+/)[1].trim();

                //     let htmlResponse = "<div class='day-box'><h3>하루 식단</h3>";

                //     mealMatches.forEach(meal => {
                //         const [mealType, mealItems] = meal.split(':');
                //         htmlResponse += `<p><strong>${mealType}:</strong> ${mealItems.trim()}</p>\n`;
                //     });

                //     htmlResponse += `<p class="diet-explanation">${explanation}</p>`;
                //     htmlResponse += `</div>`;

                //     document.getElementById("diet-plan").innerHTML = htmlResponse;
                //     document.getElementById('loading').style.display = 'none';
                // }else{
                //     const rp = "주의사항: 개인의 건강 상태와 식이 요구량에 따라 다른 식단이 필요할 수 있습니다. 추천하는 식단은 일반적인 참고용으로 사용해주세요. 월요일: - 아침: 샌드위치 (호두, 닭가슴살, 야채), 요거트 - 점심: 불고기 비빔밥, 김치, 된장국 - 저녁: 꽁치구이, 고구마, 쌈 부차 화요일: - 아침: 오믈렛, 토마토 주스 - 점심: 두부전, 김밥, 미역국 - 저녁: 갈비찜, 콩나물무침, 상추겉절이 수요일: - 아침: 시리얼과 우유, 바나나 - 점심: 된장찌개, 고등어 조림, 도토리묵 - 저녁: 삼겹살구이, 부추전, 오이무침 목요일: - 아침: 요거트 스무디, 견과류 - 점심: 불고기 부대찌개, 깻잎볶음, 떡볶이 - 저녁: 오징어볶음, 봉어묵조림, 부추겉절이 금요일: - 아침: 닭가슴살 샐러드, 닭곰탕 - 점심: 잡채, 계란국, 애호박볶음 - 저녁: 돼지고기 김치찌개, 콩나물무침, 동태전 토요일: - 아침: 팬케이크, 오렌지주스 - 점심: 떡갈비, 비빔냉면, 미역국 - 저녁: 쭈꾸미볶음, 홍어채무침, 김밥 일요일: - 아침: 굴죽, 달걀찜 - 점심: 소고기 무국, 갈치양념구이, 꽃맛살샐러드 - 저녁: 된장찜닭, 감자조림, 오이냉국 이 식단은 종합적인 영양소를 고려하여 한국 요리를 중심으로 구성되었습니다. 식단을 조절하거나 특별한 식이요구량이 있을 경우 전문가와 상의하시는 것이 좋습니다."
                //     // 요일을 구분하는 정규 표현식 수정
                //     const days = rp.split(/(?=월요일|화요일|수요일|목요일|금요일|토요일|일요일)/);

                //     // HTML 생성
                //     let htmlResponse = '';

                //     days.forEach(day => {
                //         const firstColonIndex = day.indexOf(':');
                //         const dayName = day.slice(0, firstColonIndex).trim();
                //         const meals = day.slice(firstColonIndex + 1).trim();
                //         if (meals) {
                //             // 아침, 점심, 저녁을 유연하게 매칭하는 정규 표현식
                //             const mealMatches = meals.match(/- 아침:.*?(?=- 점심:|- 저녁:|$)|- 점심:.*?(?=- 저녁:|$)|- 저녁:\s?([^\n]*)/g);
                           
                //             if (mealMatches) {
                //                 let breakfast = mealMatches[0];
                //                 let lunch = mealMatches[1];
                //                 let dinner = mealMatches[2];

                //                 htmlResponse += `<div class="day-box">\n<h3>${dayName.trim()}</h3>\n`;
                //                 htmlResponse += `<p><strong>아침:</strong> ${breakfast ? breakfast.split(':')[1].trim() : '없음'}</p>\n`;
                //                 htmlResponse += `<p><strong>점심:</strong> ${lunch ? lunch.split(':')[1].trim() : '없음'}</p>\n`;
                //                 htmlResponse += `<p><strong>저녁:</strong> ${dinner ? dinner.split(':')[1].trim() : '없음'}</p>\n`;
                //                 htmlResponse += `</div>\n`;
                //             }
                //         }
                //     });
                //     document.getElementById("diet-plan").innerHTML = htmlResponse;

                //     console.log(htmlResponse);
                //     document.getElementById('loading').style.display = 'none';
                // }



                axios.post('/get_diet', {
                    diet_type: diet_type
                })
                .then(function(response) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('diet-plan').innerHTML = response.data.diet_plan;
                    const rp = response.data.diet_plan;
                    if(diet_type == "하루"){
                        const mealMatches = rp.match(/(아침|점심|저녁|):\s?([^\n]+)/g);

                        let htmlResponse = "<div class='day-box'><h3>하루 식단</h3>";

                        mealMatches.forEach(meal => {
                            const [mealType, mealItems] = meal.split(':');
                            htmlResponse += `<p><strong>${mealType}:</strong> ${mealItems.trim()}</p>\n`;
                        });

                        htmlResponse += `</div>`;

                        document.getElementById("diet-plan").innerHTML = htmlResponse;
                        document.getElementById('loading').style.display = 'none';
                    }else{
                         // 주간 식단을 처리
                        const days = rp.split(/(?=월요일|화요일|수요일|목요일|금요일|토요일|일요일)/); // 요일별로 식단 분리

                        let htmlResponse = '';

                        days.forEach(day => {
                            const lines = day.split('\n'); // 각 요일의 식단을 줄별로 나눔
                            const dayName = lines[0].trim(); // 첫 번째 줄이 요일 이름
                            const mealData = lines.slice(1).join('\n'); // 요일 이름을 제외한 나머지가 식단

                            if (mealData) {
                                // 요일별 아침, 점심, 저녁을 추출
                                const mealMatches = mealData.match(/- 아침:\s?([^\n]*)|- 점심:\s?([^\n]*)|- 저녁:\s?([^\n]*)/g);

                                let breakfast = mealMatches?.[0]?.split(':')[1]?.trim() || '없음';
                                let lunch = mealMatches?.[1]?.split(':')[1]?.trim() || '없음';
                                let dinner = mealMatches?.[2]?.split(':')[1]?.trim() || '없음';

                                htmlResponse += `<div class="day-box">\n<h3>${dayName}</h3>\n`;
                                htmlResponse += `<p><strong>아침:</strong> ${breakfast}</p>\n`;
                                htmlResponse += `<p><strong>점심:</strong> ${lunch}</p>\n`;
                                htmlResponse += `<p><strong>저녁:</strong> ${dinner}</p>\n`;
                                htmlResponse += `</div>\n`;
                            }
                        });

                        document.getElementById("diet-plan").innerHTML = htmlResponse;
                        console.log(htmlResponse);
                        document.getElementById('loading').style.display = 'none';
                    }
                })
                .catch(function(error) {
                    console.error(error);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('diet-plan').innerHTML = 'Failed to load diet plan.';
                });
            }

        </script>
    </div>
</body>
</html>